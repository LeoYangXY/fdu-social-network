<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾äº¤ç½‘ç»œåˆ†æå¹³å°</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            margin: 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        .form-group select, .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-approved;
            transform: none;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }
        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        .progress-section {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        .progress-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .progress-bar {
            flex: 1;
            height: 25px;
            background: #ddd;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
            width: 0%;
            position: relative;
        }
        .progress-text {
            font-weight: bold;
            font-size: 14px;
            color: #2c3e50;
        }
        .results-section {
            display: none;
            margin-top: 25px;
        }
        .section-title {
            color: #2c3e50;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin: 30px 0 20px 0;
            font-size: 1.5em;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .metric-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-3px);
        }
        .metric-card h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 0.9em;
            font-weight: 600;
        }
        .metric-card p {
            margin: 0;
            font-size: 1.4em;
            font-weight: bold;
            color: #34495e;
        }
        .sub-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .sub-metric-card {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }
        .sub-metric-card h4 {
            margin: 0 0 5px 0;
            color: #6c757d;
            font-size: 0.8em;
        }
        .sub-metric-card p {
            margin: 0;
            font-size: 1.1em;
            font-weight: bold;
            color: #495057;
        }
        .visualization-section {
            margin: 30px 0;
        }
        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .visualization-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .visualization-item:hover {
            transform: translateY(-3px);
        }
        .visualization-item h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            text-align: center;
            font-size: 1.1em;
        }
        .visualization-item img {
            width: 100%;
            height: auto;
            border: 1px solid #dee2e6;
            border-radius: 6px;
        }
        .leaders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        .leaders-table th, .leaders-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: center;
        }
        .leaders-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        .leaders-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .leaders-table tr:hover {
            background-color: #e9ecef;
        }
        .community-section {
            margin: 30px 0;
        }
        .community-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .community-stat-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .community-stat-card h4 {
            margin: 0 0 8px 0;
            color: #0d47a1;
        }
        .community-stat-card p {
            margin: 0;
            font-size: 1.2em;
            font-weight: bold;
            color: #1565c0;
        }
        .community-details {
            margin-top: 20px;
        }
        .community-detail-item {
            background: #f1f8e9;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 3px solid #8bc34a;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 6px 6px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .export-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }
        .export-btn {
            margin: 0 5px;
        }
        @media (max-width: 768px) {
            .visualization-grid {
                grid-template-columns: 1fr;
            }
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            .content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ ç¤¾äº¤ç½‘ç»œåˆ†æå¹³å°</h1>
            <p>æ·±å…¥æŒ–æ˜ç¤¾äº¤ç½‘ç»œç»“æ„ä¸å½±å“åŠ›åˆ†æ</p>
        </div>
        
        <div class="content">
            <div class="form-section">
                <h2>ğŸ“Š åˆ†æé…ç½®</h2>
                <div class="form-group">
                    <label for="datasetSelect">é€‰æ‹©æ•°æ®é›†:</label>
                    <select id="datasetSelect">
                        <option value="facebook">Facebook ç¤¾äº¤ç½‘ç»œ</option>
                        <option value="wiki-vote">ç»´åŸºç™¾ç§‘æŠ•ç¥¨ç½‘ç»œ</option>
                        <option value="amazon">äºšé©¬é€Šå•†å“å…³è”ç½‘ç»œ</option>
                        <option value="youtube">YouTube è§†é¢‘åˆ†äº«ç½‘ç»œ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="topKInput">æ„è§é¢†è¢–æ•°é‡:</label>
                    <input type="number" id="topKInput" value="10" min="1" max="50">
                </div>
                
                <button id="analyzeBtn" class="btn">å¼€å§‹åˆ†æ</button>
                <button id="clearCacheBtn" class="btn btn-secondary">æ¸…ç©ºç¼“å­˜</button>
            </div>
            
            <div id="progressSection" class="progress-section">
                <h3>ğŸ”„ åˆ†æè¿›åº¦</h3>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <span id="progressText" class="progress-text">0%</span>
                </div>
                <p id="progressStatus">å‡†å¤‡å¼€å§‹...</p>
                <p id="progressDetails"></p>
            </div>
            
            <div id="resultsSection" class="results-section">
                <h2 class="section-title">ğŸ“ˆ åˆ†æç»“æœ</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="overview">æ¦‚è§ˆ</div>
                    <div class="tab" data-tab="metrics">ç½‘ç»œæŒ‡æ ‡</div>
                    <div class="tab" data-tab="leaders">æ„è§é¢†è¢–</div>
                    <div class="tab" data-tab="communities">ç¤¾åŒºç»“æ„</div>
                    <div class="tab" data-tab="visualizations">å¯è§†åŒ–</div>
                </div>
                
                <div class="tab-content active" id="overviewTab">
                    <div id="metricsSection" class="metrics-grid">
                        <!-- æŒ‡æ ‡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </div>
                </div>
                
                <div class="tab-content" id="metricsTab">
                    <h3 class="section-title">å…¨å±€ç½‘ç»œæŒ‡æ ‡</h3>
                    <div id="globalMetricsSection" class="metrics-grid">
                        <!-- å…¨å±€æŒ‡æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </div>
                    
                    <h3 class="section-title">é™„åŠ ç½‘ç»œæŒ‡æ ‡</h3>
                    <div id="additionalMetricsSection" class="sub-metrics-grid">
                        <!-- é™„åŠ æŒ‡æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </div>
                </div>
                
                <div class="tab-content" id="leadersTab">
                    <h3 class="section-title">ğŸ‘‘ æ„è§é¢†è¢– Top</h3>
                    <table id="leadersTable" class="leaders-table">
                        <thead>
                            <tr>
                                <th>èŠ‚ç‚¹</th>
                                <th>åº¦ä¸­å¿ƒæ€§</th>
                                <th>ä»‹æ•°ä¸­å¿ƒæ€§</th>
                                <th>æ¥è¿‘ä¸­å¿ƒæ€§</th>
                                <th>ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§</th>
                            </tr>
                        </thead>
                        <tbody id="leadersTableBody">
                            <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                        </tbody>
                    </table>
                </div>
                
                <div class="tab-content" id="communitiesTab">
                    <h3 class="section-title">ğŸ‘¥ ç¤¾åŒºç»“æ„åˆ†æ</h3>
                    <div id="communityStatsSection" class="community-stats">
                        <!-- ç¤¾åŒºç»Ÿè®¡å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </div>
                    
                    <div class="community-details">
                        <h4>ç¤¾åŒºè¯¦ç»†ä¿¡æ¯</h4>
                        <div id="communityDetailsSection">
                            <!-- ç¤¾åŒºè¯¦ç»†ä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="visualizationsTab">
                    <h3 class="section-title">ğŸ–¼ï¸ å¯è§†åŒ–å›¾è¡¨</h3>
                    <div id="visualizationsContainer" class="visualization-grid">
                        <!-- å›¾è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </div>
                </div>
                
                <div class="export-section">
                    <h3>ğŸ’¾ å¯¼å‡ºç»“æœ</h3>
                    <button class="btn export-btn" onclick="exportResults('json')">JSONæ ¼å¼</button>
                    <button class="btn export-btn" onclick="exportResults('csv')">CSVæ ¼å¼</button>
                    <button class="btn export-btn" onclick="printResults()">æ‰“å°æŠ¥å‘Š</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const analyzeBtn = document.getElementById('analyzeBtn');
        const datasetSelect = document.getElementById('datasetSelect');
        const topKInput = document.getElementById('topKInput');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const progressStatus = document.getElementById('progressStatus');
        const progressDetails = document.getElementById('progressDetails');
        const resultsSection = document.getElementById('resultsSection');
        const metricsSection = document.getElementById('metricsSection');
        const globalMetricsSection = document.getElementById('globalMetricsSection');
        const additionalMetricsSection = document.getElementById('additionalMetricsSection');
        const leadersTableBody = document.getElementById('leadersTableBody');
        const visualizationsContainer = document.getElementById('visualizationsContainer');
        const clearCacheBtn = document.getElementById('clearCacheBtn');
        const communityStatsSection = document.getElementById('communityStatsSection');
        const communityDetailsSection = document.getElementById('communityDetailsSection');

        // æ ‡ç­¾é¡µåˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨æ ‡ç­¾
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // æ¿€æ´»ç‚¹å‡»çš„æ ‡ç­¾
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab') + 'Tab';
                document.getElementById(tabId).classList.add('active');
            });
        });

        // å¼€å§‹åˆ†æ
        analyzeBtn.addEventListener('click', async () => {
            const dataset = datasetSelect.value;
            const topK = parseInt(topKInput.value);
            
            if (isNaN(topK) || topK < 1) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ„è§é¢†è¢–æ•°é‡ï¼');
                return;
            }
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            progressSection.style.display = 'block';
            resultsSection.style.display = 'none';
            progressFill.style.width = '0%';
            progressText.textContent = '0%';
            progressStatus.textContent = 'æ­£åœ¨å‡†å¤‡åˆ†æ...';
            progressDetails.textContent = '';
            
            try {
                // å‘é€åˆ†æè¯·æ±‚
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        dataset: dataset,
                        top_k: topK,
                        use_cache: true
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // å¦‚æœç»“æœåŒ…å«ä»»åŠ¡IDï¼Œè¯´æ˜éœ€è¦è½®è¯¢è¿›åº¦
                if (result.task_id) {
                    await pollProgress(result.task_id);
                } else {
                    // å¦‚æœç«‹å³è¿”å›ç»“æœï¼Œç›´æ¥æ˜¾ç¤º
                    displayResults(result);
                }
                
            } catch (error) {
                console.error('åˆ†æå¤±è´¥:', error);
                progressStatus.textContent = 'åˆ†æå¤±è´¥: ' + error.message;
                progressDetails.textContent = '';
            }
        });

        // è½®è¯¢è¿›åº¦
        async function pollProgress(taskId) {
            const interval = setInterval(async () => {
                try {
                    const response = await fetch(`/api/progress/${taskId}`);
                    const progress = await response.json();
                    
                    if (response.ok && !progress.error) {
                        // æ›´æ–°è¿›åº¦
                        progressFill.style.width = progress.progress + '%';
                        progressText.textContent = progress.progress + '%';
                        progressStatus.textContent = progress.status;
                        progressDetails.textContent = progress.details || '';
                        
                        // å¦‚æœå®Œæˆï¼Œæ˜¾ç¤ºç»“æœ
                        if (progress.completed && progress.result) {
                            clearInterval(interval);
                            displayResults(progress.result);
                        }
                    } else {
                        // å¦‚æœAPIè¿”å›é”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                        clearInterval(interval);
                        progressStatus.textContent = 'è·å–è¿›åº¦å¤±è´¥: ' + (progress.error || 'æœªçŸ¥é”™è¯¯');
                        progressDetails.textContent = '';
                    }
                } catch (error) {
                    console.error('è½®è¯¢è¿›åº¦å¤±è´¥:', error);
                    clearInterval(interval);
                    progressStatus.textContent = 'è½®è¯¢è¿›åº¦å¤±è´¥: ' + error.message;
                    progressDetails.textContent = '';
                }
            }, 1000);
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(result) {
            // éšè—è¿›åº¦æ¡
            progressSection.style.display = 'none';
            
            // æ¸…ç©ºä¹‹å‰çš„æ•°æ®æ˜¾ç¤º
            metricsSection.innerHTML = '';
            globalMetricsSection.innerHTML = '';
            additionalMetricsSection.innerHTML = '';
            leadersTableBody.innerHTML = '';
            visualizationsContainer.innerHTML = '';
            communityStatsSection.innerHTML = '';
            communityDetailsSection.innerHTML = '';
            
            // æ˜¾ç¤ºå…¨å±€æŒ‡æ ‡ - æ¦‚è§ˆéƒ¨åˆ†
            const globalMetrics = result.global_metrics;
            const overviewMetrics = [
                { title: 'èŠ‚ç‚¹æ•°é‡', value: globalMetrics.nodes || 0, color: '#667eea' },
                { title: 'è¾¹æ•°é‡', value: globalMetrics.edges || 0, color: '#764ba2' },
                { title: 'ç½‘ç»œå¯†åº¦', value: globalMetrics.density?.toFixed(6) || 0, color: '#f093fb' },
                { title: 'å¹³å‡èšç±»ç³»æ•°', value: globalMetrics.average_clustering?.toFixed(6) || 0, color: '#f5576c' },
                { title: 'å¹³å‡åº¦', value: globalMetrics.average_degree?.toFixed(2) || 0, color: '#4facfe' },
                { title: 'ä¼ é€’æ€§', value: globalMetrics.transitivity?.toFixed(6) || 0, color: '#00f2fe' },
                { title: 'åŒé…æ€§', value: globalMetrics.assortativity?.toFixed(6) || 0, color: '#43e97b' },
                { title: 'è¿é€šåˆ†é‡æ•°', value: globalMetrics.connected_components || 0, color: '#fa709a' }
            ];
            
            overviewMetrics.forEach(metric => {
                const card = document.createElement('div');
                card.className = 'metric-card';
                card.innerHTML = `
                    <h3>${metric.title}</h3>
                    <p style="color: ${metric.color}">${metric.value}</p>
                `;
                metricsSection.appendChild(card);
            });
            
            // æ˜¾ç¤ºå…¨å±€æŒ‡æ ‡ - è¯¦ç»†éƒ¨åˆ†
            const detailedMetrics = [
                { title: 'èŠ‚ç‚¹æ•°é‡', value: globalMetrics.nodes || 0 },
                { title: 'è¾¹æ•°é‡', value: globalMetrics.edges || 0 },
                { title: 'ç½‘ç»œå¯†åº¦', value: globalMetrics.density?.toFixed(6) || 0 },
                { title: 'å¹³å‡èšç±»ç³»æ•°', value: globalMetrics.average_clustering?.toFixed(6) || 0 },
                { title: 'å¹³å‡åº¦', value: globalMetrics.average_degree?.toFixed(2) || 0 },
                { title: 'ä¼ é€’æ€§', value: globalMetrics.transitivity?.toFixed(6) || 0 },
                { title: 'åŒé…æ€§', value: globalMetrics.assortativity?.toFixed(6) || 0 },
                { title: 'è¿é€šåˆ†é‡æ•°', value: globalMetrics.connected_components || 0 },
                { title: 'æœ€å¤§è¿é€šåˆ†é‡å¤§å°', value: globalMetrics.largest_component_size || 0 },
                { title: 'ç›´å¾„', value: globalMetrics.diameter || 'N/A' },
                { title: 'åŠå¾„', value: globalMetrics.radius || 'N/A' },
                { title: 'å¹³å‡æœ€çŸ­è·¯å¾„', value: globalMetrics.avg_shortest_path || 'N/A' }
            ];
            
            detailedMetrics.forEach(metric => {
                const card = document.createElement('div');
                card.className = 'metric-card';
                card.innerHTML = `
                    <h3>${metric.title}</h3>
                    <p>${metric.value}</p>
                `;
                globalMetricsSection.appendChild(card);
            });
            
            // æ˜¾ç¤ºé™„åŠ æŒ‡æ ‡
            const additionalMetrics = result.global_metrics; // è¿™é‡ŒåŒ…å«äº†é™„åŠ æŒ‡æ ‡
            const additionalMetricItems = [
                { title: 'æœ€å¤§åº¦', value: additionalMetrics.max_degree || 0 },
                { title: 'æœ€å°åº¦', value: additionalMetrics.min_degree || 0 },
                { title: 'å¹³å‡åº¦', value: additionalMetrics.avg_degree?.toFixed(2) || 0 },
                { title: 'HæŒ‡æ•°', value: additionalMetrics.h_index || 0 }
            ];
            
            additionalMetricItems.forEach(metric => {
                const card = document.createElement('div');
                card.className = 'sub-metric-card';
                card.innerHTML = `
                    <h4>${metric.title}</h4>
                    <p>${metric.value}</p>
                `;
                additionalMetricsSection.appendChild(card);
            });
            
            // æ˜¾ç¤ºæ„è§é¢†è¢–è¡¨æ ¼
            const leaders = result.opinion_leaders || [];
            leaders.forEach(leader => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${leader.node}</td>
                    <td>${(leader.degree_score || 0).toFixed(6)}</td>
                    <td>${(leader.betweenness_score || 0).toFixed(6)}</td>
                    <td>${(leader.closeness_score || 0).toFixed(6)}</td>
                    <td>${(leader.eigenvector_score || 0).toFixed(6)}</td>
                `;
                leadersTableBody.appendChild(row);
            });
            
            // æ˜¾ç¤ºç¤¾åŒºç»Ÿè®¡
            const communityInfo = result.community_info || {};
            const communityStats = [
                { title: 'ç¤¾åŒºæ€»æ•°', value: communityInfo.num_communities || 0, color: '#2196F3' },
                { title: 'æ¨¡å—åº¦', value: communityInfo.modularity?.toFixed(6) || 0, color: '#FF9800' },
                { title: 'æœ€å¤§ç¤¾åŒºå¤§å°', value: Math.max(...Object.values(communityInfo.community_sizes || {}), 0), color: '#4CAF50' },
                { title: 'å¹³å‡ç¤¾åŒºå¤§å°', value: communityInfo.num_communities ? 
                    Math.round((globalMetrics.nodes || 0) / communityInfo.num_communities) : 0, color: '#9C27B0' }
            ];
            
            communityStats.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'community-stat-card';
                card.innerHTML = `
                    <h4>${stat.title}</h4>
                    <p style="color: ${stat.color}">${stat.value}</p>
                `;
                communityStatsSection.appendChild(card);
            });
            
            // æ˜¾ç¤ºç¤¾åŒºè¯¦ç»†ä¿¡æ¯
            const communityDetails = communityInfo.details || [];
            communityDetails.forEach(detail => {
                const item = document.createElement('div');
                item.className = 'community-detail-item';
                item.innerHTML = `
                    <strong>ç¤¾åŒº ${detail.id}:</strong> 
                    å¤§å°: ${detail.size}, 
                    å†…éƒ¨è¾¹æ•°: ${detail.internal_edges}, 
                    å¯†åº¦: ${detail.density.toFixed(6)}
                `;
                communityDetailsSection.appendChild(item);
            });
            
            // æ˜¾ç¤ºå¯è§†åŒ–å›¾è¡¨
            const visualizations = result.visualizations || {};
            const visualizationNames = {
                'network_structure': 'ç½‘ç»œç»“æ„å›¾',
                'degree_dist': 'åº¦åˆ†å¸ƒå›¾',
                'communities': 'ç¤¾åŒºç»“æ„å›¾',
                'centrality_comparison': 'ä¸­å¿ƒæ€§å¯¹æ¯”å›¾',
                'community_size_dist': 'ç¤¾åŒºè§„æ¨¡åˆ†å¸ƒ'
            };
            
            Object.entries(visualizations).forEach(([key, base64Data]) => {
                if (base64Data) {
                    const item = document.createElement('div');
                    item.className = 'visualization-item';
                    item.innerHTML = `
                        <h3>${visualizationNames[key] || key}</h3>
                        <img src="data:image/png;base64,${base64Data}" alt="${visualizationNames[key] || key}">
                    `;
                    visualizationsContainer.appendChild(item);
                }
            });
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            resultsSection.style.display = 'block';
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // å¯¼å‡ºç»“æœåŠŸèƒ½
        function exportResults(format) {
            alert(`å¯¼å‡ºåŠŸèƒ½å°†åœ¨å®é™…éƒ¨ç½²ä¸­å®ç°\næ ¼å¼: ${format}\nè¿™éœ€è¦åç«¯APIæ”¯æŒæ–‡ä»¶ä¸‹è½½`);
        }

        function printResults() {
            window.print();
        }

        // æ¸…ç©ºç¼“å­˜
        clearCacheBtn.addEventListener('click', async () => {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºç¼“å­˜å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ç¼“å­˜çš„åˆ†æç»“æœã€‚')) {
                try {
                    const response = await fetch('/api/cache/clear', {
                        method: 'POST'
                    });
                    const result = await response.json();
                    if (response.ok) {
                        alert('ç¼“å­˜å·²æ¸…ç©ºï¼');
                    } else {
                        alert('æ¸…ç©ºç¼“å­˜å¤±è´¥: ' + result.error);
                    }
                } catch (error) {
                    alert('æ¸…ç©ºç¼“å­˜å¤±è´¥: ' + error.message);
                }
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåè·å–å¯ç”¨æ•°æ®é›†
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/api/datasets');
                const datasets = await response.json();
                
                // æ›´æ–°æ•°æ®é›†é€‰æ‹©æ¡†
                datasetSelect.innerHTML = '';
                datasets.forEach(dataset => {
                    const option = document.createElement('option');
                    option.value = dataset;
                    option.textContent = dataset.charAt(0).toUpperCase() + dataset.slice(1).replace('-', ' ');
                    datasetSelect.appendChild(option);
                });
            } catch (error) {
                console.error('è·å–æ•°æ®é›†å¤±è´¥:', error);
            }
        });
    </script>
</body>
</html>